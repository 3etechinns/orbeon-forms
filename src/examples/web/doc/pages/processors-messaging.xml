<!--
    Copyright (C) 2004 Orbeon, Inc.

    The Orbeon documentation is not distributed under the LGPL license. Use of the documentation is
    subject to the following terms:

    * Conversion to other formats is allowed, but the actual content may not be altered or edited
      in any way.

    * You may create printed copies for your own personal use.

    * For all other uses, such as selling printed copies or using (parts of) the manual in another
      publication, prior written agreement from Orbeon, Inc. is required.

    Please contact Orbeon at info@orbeon.com for more information.
-->
<document xmlns:p="http://www.orbeon.com/oxf/pipeline">
    <header>
        <title>Messaging</title>
    </header>
    <body>
        <anchor id="email"/>
        <section>
            <title>Email Processor</title>
            <p>
                This processor can send emails through an SMTP server. Its data input contains the
                host, email header and body. The host can be overridden globally in <link
                href="reference-properties">Presentation Server Properties</link> file. The body
                can either contain a simple text message or multiple MIME parts.
            </p>
            <section>
                <title>Data Input</title>
                <p>
                    The <code>data</code> input contains the configuration of
                    the processor as well as the message header and body. The following table describes the configuration elements:

                </p>
                <table>
                    <tr>
                        <th>Name</th>
                        <th>Cardinality</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>message</td>
                        <td>1</td>
                        <td>Root element</td>
                    </tr>
                    <tr>
                        <td>message/smtp-host</td>
                        <td>1</td>
                        <td>The SMTP Host used to send the message</td>
                    </tr>
                    <tr>
                        <td>message/from</td>
                        <td>1</td>
                        <td>Sender of the message. Contains an <code>email</code> element and an optional <code>name</code> element</td>
                    </tr>
                    <tr>
                        <td>message/to</td>
                        <td>1..n</td>
                        <td>Recipient(s) of the message. Contains an <code>email</code> element and an optional <code>name</code> element</td>
                    </tr>
                    <tr>
                        <td>message/subject</td>
                        <td>1</td>
                        <td>Subject of the message</td>
                    </tr>
                    <tr>
                        <td>message/text</td>
                        <td>1</td>
                        <td>Text body of the message</td>
                    </tr>
                    <tr>
                        <td colspan="3"> - or --</td>
                    </tr>
                    <tr>
                        <td>message/body</td>
                        <td>1</td>
                        <td>Indicates a MIME body containing multiple parts</td>
                    </tr>
                    <tr>
                        <td>message/body/@mime-multipart</td>
                        <td>1</td>
                        <td>The MIME multipart type. <code>mixed</code>(default) and <code>alternative</code> are supported.</td>
                    </tr>
                    <tr>
                        <td>message/body/part</td>
                        <td>1..n</td>
                        <td>A MIME body part</td>
                    </tr>
                    <tr>
                        <td>message/body/part/@name</td>
                        <td>1</td>
                        <td>The name of this body part</td>
                    </tr>
                    <tr>
                        <td>message/body/part@/content-type</td>
                        <td>1</td>
                        <td>The MIME type of tdis body part</td>
                    </tr>
                    <tr>
                        <td>message/body/part/*</td>
                        <td>1</td>
                        <td>Thr content of the body part. Use a CDATA section for HTML</td>
                    </tr>
                </table>
            </section>
            <section>
                <title>Example</title>
                <p>
                The following example illustrates the use of the Email
                Processor. Note that the
                    <code>name</code> element is optional
                and that multiple recipients are allowed.
                </p>
                <xml-source>
                    <p:processor name="oxf:email">
                        <p:input name="data">
                            <message>
                                <smtp-host>mail.company.com</smtp-host>
                                <from>
                                    <email>trove@smith.com</email>
                                    <name>Trove Smith</name>
                                </from>
                                <to>
                                    <email>jani@smith.com</email>
                                    <name>Jani Smith</name>
                                </to>
                                <subject>Reminder</subject>
                                <body mime-multipart="alternative">
                                    <part name="part1" content-type="text/plain">
                                      This is part 1
                                    </part>
                                    <part name="part2" content-type="text/html">
                                        <![CDATA[
                                         <html>
                                          <body>
                                            This is part 2
                                          </body>
                                         </html>
                                        ]]>
                                    </part>
                                </body>
                            </message>
                        </p:input>
                    </p:processor>
                </xml-source>
            </section>
        </section>
        <!--
        <anchor id="yim"/>
        <section>
            <title>Yahoo Instant Messaging Processor</title>
            <p>
                This processor can send and receive Yahoo Instant Messages (IM)
                from within a Web application. To use this processor, you need to
                create a Yahoo account that will act as the sender. You can
                send an IM to any Yahoo subscriber. The processor launches a
                customizable pipeline when an IM is received. The IM processor
                has two mandatory inputs:
                <code>session</code> contains login
                information, and
                <code>message</code> contains the message to
                send. A third input, declared in the
                <code>on-message-received</code> element contains the pipeline
                to be executed when a message is received. This pipeline must
                have a
                <code>data</code> input parameter containing a document
                describing the incoming message:
            </p>
            <p>
                <xml-source>
                    <message>
                        <from>john</from>
                        <body>Hello!</body>
                    </message>
                </xml-source>
            </p>
            <section>
                <title>Config Input</title>
                <p>
                    The
                    <code>config</code> input contains basic information
                    such as login, password and definition of the pipeline to
                    execute when an IM is received.
                </p>
                <p>
                    <table ca="|l|p{0.6\textwidth}|">
                        <tr>
                            <th>
                                <code>login</code>
                            </th>
                            <td>A Yahoo account, used as the sender of the IM</td>
                        </tr>
                        <tr>
                            <th>
                                <code>password</code>
                            </th>
                            <td>The matching password</td>
                        </tr>
                        <tr>
                            <th>
                                <code>on-message-received</code>
                            </th>
                            <td>
                                <ul>
                                    <li>A URL pointing to an XPL pipeline</li>
                                    <li>An input name, starting with a
                                        <code>#</code>. The IMSerializer must have
                                        the corresponding input declared.
                                    </li>
                                </ul>
                            </td>
                        </tr>
                    </table>
                </p>
            </section>
            <section>
                <title>Data Input</title>
                <p>
                    The
                    <code>data</code> input contains the message to send under
                    the
                    <code>message</code> element.
                </p>
                <p>
                    <table>
                        <tr>
                            <th>
                                <code>to</code>
                            </th>
                            <td>A Yahoo account to send to message to</td>
                        </tr>
                        <tr>
                            <th>
                                <code>body</code>
                            </th>
                            <td>The body of the message to send</td>
                        </tr>
                    </table>
                </p>
            </section>
            <section>
                <title>Example</title>
                <p>
                    The following code illustrates the instantiation of the
                    IMSerializer to send a message to the Yahoo account
                    <code>tove</code> from
                    <code>jani</code>. Additionally, a
                    statement is written in the log file when a message is received.
                </p>
                <xml-source>
                    <p:processor name="oxf:im">
                        <p:input name="config">
                            <session>
                                <login>jani</login>
                                <password>secret</password>
                                <on-message-received>#response-pipeline</on-message-received>
                            </session>
                        </p:input>
                        <p:input name="data">
                            <message>
                                <to>trove</to>
                                <body>Don't forget me!</body>
                            </message>
                        </p:input>
                        <p:input name="response-pipeline">
                            <p:config>
                                <p:param name="data" type="input"/>
                                <p:processor name="oxf:null-serializer">
                                    <p:input name="data" href="#data"/>
                                </p:processor>
                            </p:config>
                        </p:input>
                    </p:processor>
                </xml-source>
            </section>
        </section>
        -->
    </body>
</document>
