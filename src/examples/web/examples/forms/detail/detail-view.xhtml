<!--
    Copyright (C) 2006 Orbeon, Inc.

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<html xmlns:xs="http://www.w3.org/2001/XMLSchema"
      xmlns:xforms="http://www.w3.org/2002/xforms"
      xmlns:ev="http://www.w3.org/2001/xml-events"
      xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:f="http://orbeon.org/oxf/xml/formatting"
      xmlns:xhtml="http://www.w3.org/1999/xhtml"
      xmlns:dmv="http://orbeon.org/oxf/examples/dmv"
      xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <title>OPS Forms Example</title>
        <link rel="stylesheet" type="text/css" href="/examples/forms/style.css"/>
        <!-- Main XForms model -->
        <xforms:model id="main-model" schema="oxf:/examples/forms/detail/form-schema.xsd">

            <!-- This action performs initializations necessary upon initialization -->
            <xforms:action ev:event="xforms-ready">
            </xforms:action>

            <!-- This action clears all the fields of the mailing address -->
            <xforms:action ev:event="dmv-clear-mailing-address">
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:street/dmv:number"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:street/dmv:name-1"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:street/dmv:name-2"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:apt"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:city"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:state"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:address[@type = 'mailing']/dmv:zip"/>
            </xforms:action>

            <!-- This action clears all the fields of the vehicle address -->
            <xforms:action ev:event="dmv-clear-vehicle-address">
                <xforms:setvalue ref="instance('main-instance')//dmv:vehicle-address/dmv:street/dmv:number"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:vehicle-address/dmv:street/dmv:name-1"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:vehicle-address/dmv:street/dmv:name-2"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:vehicle-address/dmv:city"/>
                <xforms:setvalue ref="instance('main-instance')//dmv:vehicle-address/dmv:county"/>
            </xforms:action>

            <!-- Main XForms instance provided by the page model -->
            <xforms:instance id="main-instance">
                <xi:include href="input:data"/>
            </xforms:instance>

            <xforms:bind nodeset="instance('main-instance')">
                <!-- Metadata -->
                <xforms:bind nodeset="document-date" calculate="current-dateTime()"/>
                <!-- Business data -->
                <xforms:bind nodeset="//dmv:personal-information">
                    <!-- Date types -->
                    <xforms:bind nodeset="dmv:birth-date" type="xs:date"/>
                </xforms:bind>
                <!-- Don't care about xml:base -->
                <xforms:bind nodeset="//@xml:base" relevant="false()"/>
            </xforms:bind>

            <!-- XForms instance containing user messages -->
            <xforms:instance id="messages-instance" src="oxf:/examples/forms/detail/messages.xml"/>

            <!-- XForms instance containing template for mailing address -->
            <xforms:instance id="mailing-address-template-instance" src="oxf:/examples/forms/schema/template-mailing-address.xml"/>

            <!-- XForms instance containing template for vehicle address -->
            <xforms:instance id="vehicle-address-template-instance" src="oxf:/examples/forms/schema/template-vehicle-address.xml"/>

            <!-- XForms instance for widget control information -->
            <xforms:instance id="control-instance">
                <control xmlns="">
                    <message/>
                    <data-status/>
                    <vehicle-insert-trigger/>
                    <vehicle-delete-trigger/>
                    <save-trigger/>
                    <back-trigger/>
                    <add-mailing-address/>
                    <remove-mailing-address/>
                    <clear-mailing-address/>
                    <add-vehicle-address/>
                    <remove-vehicle-address/>
                    <clear-vehicle-address/>
                </control>
            </xforms:instance>

            <xforms:bind nodeset="instance('control-instance')">
                <xforms:bind nodeset="save-trigger" relevant="../data-status = 'dirty'"/>
                <xforms:bind nodeset="back-trigger" relevant="not(../data-status = 'dirty')"/>
                <xforms:bind nodeset="vehicle-insert-trigger" readonly="count(instance('main-instance')//dmv:vehicles/dmv:vehicle) >= 4"/>
                <xforms:bind nodeset="vehicle-delete-trigger" readonly="count(instance('main-instance')//dmv:vehicles/dmv:vehicle) &lt;= 2"/>
                <xforms:bind nodeset="add-mailing-address" relevant="not(instance('main-instance')//dmv:address[@type = 'mailing'])"/>
                <xforms:bind nodeset="remove-mailing-address" relevant="instance('main-instance')//dmv:address[@type = 'mailing']"/>
                <xforms:bind nodeset="clear-mailing-address" relevant="normalize-space(instance('main-instance')//dmv:address[@type = 'mailing']) != ''"/>
                <xforms:bind nodeset="add-vehicle-address" relevant="not(instance('main-instance')//dmv:vehicle-address)"/>
                <xforms:bind nodeset="remove-vehicle-address" relevant="instance('main-instance')//dmv:vehicle-address"/>
                <xforms:bind nodeset="clear-vehicle-address" relevant="normalize-space(instance('main-instance')//dmv:vehicle-address) != ''"/>
            </xforms:bind>

            <!-- XForms instance for license plate information -->
            <xforms:instance id="plate-instance">
                <control xmlns="">
                    <plate>
                        <character/>
                        <character/>
                        <character/>
                        <character/>
                        <character/>
                        <character/>
                        <character/>
                        <character/>
                    </plate>
                </control>
            </xforms:instance>

            <xforms:bind nodeset="instance('plate-instance')">
                <xforms:bind nodeset="plate[1]/character" calculate="substring((instance('main-instance')//dmv:plate-number)[1], count(preceding-sibling::character) + 1, 1)"/>
                <!--<xforms:bind nodeset="plate[2]/character" calculate="substring((instance('main-instance')//dmv:plate-number)[2], count(preceding-sibling::character) + 1, 1)"/>-->
                <!--<xforms:bind nodeset="plate[3]/character" calculate="substring((instance('main-instance')//dmv:plate-number)[3], count(preceding-sibling::character) + 1, 1)"/>-->
            </xforms:bind>

            <!-- Save submission -->
            <xforms:submission id="save-submission" ref="instance('main-instance')"
                               method="post" replace="none" action="/forms/service/save-document">
                <xforms:action ev:event="xforms-submit-done">
                    <xforms:setvalue ref="instance('control-instance')/message">Document saved successfully!</xforms:setvalue>
                    <xforms:setvalue ref="instance('control-instance')/data-status"/>
                    <xforms:toggle case="ok-message"/>
                </xforms:action>
                <xforms:action ev:event="xforms-submit-error">
                    <xforms:setvalue ref="instance('control-instance')/message">Document could not be saved. Please check for errors in your form.</xforms:setvalue>
                    <xforms:toggle case="error-message"/>
                </xforms:action>
            </xforms:submission>

        </xforms:model>
    </head>
    <body>
        <table class="dmv-title-table">
            <tr>
                <td>
                    <img src="/examples/forms/images/dmv0-small.png" alt="DMV"/>
                </td>
                <td>
                    Notice of Change of Address
                </td>
            </tr>
        </table>

        <xforms:group ref="instance('main-instance')/document/*">
            <!-- Clear messages upon user moving around in the form -->
            <xforms:toggle ev:event="DOMFocusIn" case="no-message"/>
            <!-- Mark that data has changed -->
            <xforms:action ev:event="xforms-value-changed">
                <xforms:setvalue ref="instance('control-instance')/data-status">dirty</xforms:setvalue>
            </xforms:action>

            <table class="dmv-main-table">
                <tr>
                    <td colspan="2">
                        <table class="dmv-actions-table">
                            <tr>
                                <td>
                                    <xforms:group ref="instance('control-instance')/save-trigger">
                                        <xforms:action ev:event="DOMActivate">
                                            <xforms:send submission="save-submission"/>
                                        </xforms:action>
                                        <xforms:trigger appearance="xxforms:image">
                                            <xforms:label>Save Document</xforms:label>
                                            <xxforms:img src="/images/save.gif"/>
                                        </xforms:trigger>
                                        <xforms:trigger appearance="xxforms:link">
                                            <xforms:label>Save Document</xforms:label>
                                        </xforms:trigger>
                                    </xforms:group>
                                </td>
                                <td>
                                    <xforms:group ref="instance('control-instance')/back-trigger">
                                        <xforms:load ev:event="DOMActivate" resource="/forms"/>
                                        <xforms:trigger appearance="xxforms:image">
                                            <xforms:label>Return to Forms List</xforms:label>
                                            <xxforms:img src="/images/back.gif"/>
                                        </xforms:trigger>
                                        <xforms:trigger appearance="xxforms:link">
                                            <xforms:label>Return to Forms List</xforms:label>
                                        </xforms:trigger>
                                    </xforms:group>
                                </td>
                                <td>
                                    <xforms:switch>
                                        <xforms:case id="no-message">
                                            <span/>
                                        </xforms:case>
                                        <xforms:case id="ok-message">
                                            <span class="dmv-message-positive">
                                                <xforms:output ref="instance('control-instance')/message"/>
                                            </span>
                                        </xforms:case>
                                        <xforms:case id="error-message">
                                            <span class="dmv-message-negative">
                                                <xforms:output ref="instance('control-instance')/message"/>
                                            </span>
                                        </xforms:case>
                                    </xforms:switch>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <xforms:group ref="dmv:personal-information">
                    <tr>
                        <th>
                            Personal<br/>
                            Information<br/>
                            <img src="/examples/forms/images/dmv1-small.png" alt="Personal Information"/>
                        </th>
                        <td>
                            <table>
                                <tr>
                                    <td>
                                        <xforms:input incremental="true" ref="dmv:name/dmv:last-name" class="dmv-last-name">
                                            <xforms:label>Last Name</xforms:label>
                                            <!--<xforms:help>The last name</xforms:help>-->
                                            <xforms:alert ref="instance('messages-instance')/alerts/last-name"/>
                                        </xforms:input>
                                        <xforms:input incremental="true" ref="dmv:driver-license-number" class="dmv-driver-license-number">
                                            <xforms:label>Driver License / Id Card No.</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/driver-license-number"/>
                                        </xforms:input>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <xforms:group ref="dmv:name">
                                            <xforms:input incremental="true" ref="dmv:first-name" class="dmv-first-name">
                                                <xforms:label>First Name</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/first-name"/>
                                            </xforms:input>
                                            <xforms:input incremental="true" ref="dmv:initial" xhtml:size="2" class="dmv-initial">
                                                <xforms:label>Initial</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/initial"/>
                                            </xforms:input>
                                        </xforms:group>
                                        <xforms:input incremental="true" ref="dmv:birth-date">
                                            <xforms:label>Birth Date</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/birth-date"/>
                                        </xforms:input>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </xforms:group>
                <tr><td colspan="2" class="dmv-hr"/></tr>
                <xforms:group ref="dmv:address-information">
                    <xforms:group ref="dmv:voter-address-change">
                        <tr>
                            <th>
                                Voter Change<br/>
                                of Address<br/>
                            </th>
                            <td>
                                <xforms:select ref="dmv:change-address" appearance="full">
                                    <xforms:label>Mark this box if you do not want to change your voting address</xforms:label>
                                    <xforms:item>
                                        <xforms:label></xforms:label>
                                        <xforms:value>N</xforms:value>
                                    </xforms:item>
                                </xforms:select>
                            </td>
                        </tr>
                    </xforms:group>
                    <tr><td colspan="2" class="dmv-hr"/></tr>
                    <xforms:group ref="dmv:address[@type = 'residence']">
                        <tr>
                            <th>
                                New or Correct<br/>
                                Residence<br/>
                                Address<br/>
                                <img src="/examples/forms/images/dmv2-small.png" alt="New or Correct Residence Address"/>
                            </th>
                            <td>
                                <table>
                                    <tr>
                                        <td align="right">
                                            <xforms:input incremental="true" ref="dmv:street/dmv:number" class="dmv-street-number">
                                                <xforms:label>Street Number Only</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-number"/>
                                            </xforms:input>
                                        </td>
                                        <td>
                                            <xforms:input incremental="true" ref="dmv:street/dmv:name-1" class="dmv-street-name-1">
                                                <xforms:label>Street Name 1</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-name-1"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td align="right">
                                            <xforms:input incremental="true" ref="dmv:apt" class="dmv-apt-number">
                                                <xforms:label>Apt. No</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/apt"/>
                                            </xforms:input>
                                        </td>
                                        <td>
                                            <xforms:input incremental="true" ref="dmv:street/dmv:name-2" class="dmv-street-name-2">
                                                <xforms:label>Street Name 2</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-name-2"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <xforms:input incremental="true" ref="dmv:city" class="dmv-city">
                                                <xforms:label>City</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/city"/>
                                                <!--<xforms:hint>Do Not Abbreviate - Use First 22 Characters in City Name</xforms:hint>-->
                                            </xforms:input>
                                            <xforms:input incremental="true" ref="dmv:state" class="dmv-state">
                                                <xforms:label>State</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/state"/>
                                            </xforms:input>
                                            <xforms:input incremental="true" ref="dmv:zip" class="dmv-zip">
                                                <xforms:label>Zip Code</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/zip"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </xforms:group>
                    <tr><td colspan="2" class="dmv-hr"/></tr>
                    <tr>
                        <th>
                            New or Correct<br/>
                            Mailing<br/>
                            Address<br/>
                            <img src="/examples/forms/images/dmv3-small.png" alt="New or Correct Mailing Address"/>
                        </th>
                        <td>

                            <table class="dmv-actions-table">
                                <tr>
                                    <td>
                                        <xforms:group ref="instance('control-instance')/remove-mailing-address">
                                            <xforms:action ev:event="DOMActivate">
                                                <xforms:delete nodeset="instance('main-instance')//dmv:address[@type = 'mailing']" at="last()"/>
                                            </xforms:action>
                                            <xforms:trigger appearance="xxforms:image">
                                                <xforms:label>Remove Mailing Address</xforms:label>
                                                <xxforms:img src="/images/remove.gif"/>
                                            </xforms:trigger>
                                            <xforms:trigger appearance="xxforms:link">
                                                <xforms:label>Remove Mailing Address</xforms:label>
                                            </xforms:trigger>
                                        </xforms:group>

                                        <xforms:group ref="instance('control-instance')/clear-mailing-address">
                                            <xforms:action ev:event="DOMActivate" >
                                                <xforms:dispatch name="dmv-clear-mailing-address" target="main-model"/>
                                            </xforms:action>
                                            <xforms:trigger appearance="xxforms:image">
                                                <xforms:label>Clear Address</xforms:label>
                                                <xxforms:img src="/images/recycle-green.png"/>
                                            </xforms:trigger>
                                            <xforms:trigger appearance="xxforms:link">
                                                <xforms:label>Clear Address</xforms:label>
                                            </xforms:trigger>
                                        </xforms:group>
                                    </td>
                                    <td>
                                        <xforms:group ref="instance('control-instance')/add-mailing-address" >
                                            <xforms:action ev:event="DOMActivate">
                                                <xforms:insert nodeset="instance('main-instance')//dmv:address-information/dmv:address" at="last()" position="after"
                                                        origin="instance('mailing-address-template-instance')"/>
                                            </xforms:action>
                                            <xforms:trigger appearance="xxforms:image">
                                                <xforms:label>Add Mailing Address</xforms:label>
                                                <xxforms:img src="/images/add.gif"/>
                                            </xforms:trigger>
                                            <xforms:trigger appearance="xxforms:link">
                                                <xforms:label>Add Mailing Address</xforms:label>
                                            </xforms:trigger>
                                        </xforms:group>
                                    </td>
                                </tr>
                            </table>

                            <xforms:group ref="dmv:address[@type = 'mailing']">
                                <table>
                                    <tr>
                                        <td align="right">
                                            <xforms:input incremental="true" ref="dmv:street/dmv:number" class="dmv-street-number">
                                                <xforms:label>Street Number Only</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-number"/>
                                            </xforms:input>
                                        </td>
                                        <td>
                                            <xforms:input incremental="true" ref="dmv:street/dmv:name-1" class="dmv-street-name-1">
                                                <xforms:label>Street Name 1</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-name-1"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td align="right">
                                            <xforms:input incremental="true" ref="dmv:apt" class="dmv-apt-number">
                                                <xforms:label>Apt. No</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/apt"/>
                                            </xforms:input>
                                        </td>
                                        <td>
                                            <xforms:input incremental="true" ref="dmv:street/dmv:name-2" class="dmv-street-name-2">
                                                <xforms:label>Street Name 2</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-name-2"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <xforms:input incremental="true" ref="dmv:city" class="dmv-city">
                                                <xforms:label>City</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/city"/>
                                                <!--<xforms:hint>Do Not Abbreviate - Use First 22 Characters in City Name</xforms:hint>-->
                                            </xforms:input>
                                            <xforms:input incremental="true" ref="dmv:state" class="dmv-state">
                                                <xforms:label>State</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/state"/>
                                            </xforms:input>
                                            <xforms:input incremental="true" ref="dmv:zip" class="dmv-zip">
                                                <xforms:label>Zip Code</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/zip"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                </table>
                            </xforms:group>
                        </td>
                    </tr>
                </xforms:group>
                <tr><td colspan="2" class="dmv-hr"/></tr>
                <xforms:group ref="dmv:vehicle-information">
                    <xforms:group ref="dmv:vehicles">
                        <tr>
                            <th>
                                Vehicles,<br/>
                                Vessels, or<br/>
                                Placards<br/>
                                Owned By You<br/>
                                <br/>
                                Use Additional<br/>
                                Forms If Necessary
                            </th>
                            <td>
                                <!-- Advanced version of the triggers -->
                                <table class="dmv-actions-table">
                                    <tr>
                                        <td>
                                            <xforms:group ref="instance('control-instance')/vehicle-insert-trigger">
                                                <xforms:action ev:event="DOMActivate">
                                                    <xforms:insert nodeset="instance('main-instance')//dmv:vehicles/dmv:vehicle" at="index('vehicles-repeat')" position="after"/>
                                                    <xforms:setvalue ref="instance('main-instance')//dmv:vehicles/dmv:vehicle[index('vehicles-repeat')]/dmv:plate-number"/>
                                                    <xforms:setvalue ref="instance('main-instance')//dmv:vehicles/dmv:vehicle[index('vehicles-repeat')]/dmv:vin"/>
                                                    <xforms:setvalue ref="instance('main-instance')//dmv:vehicles/dmv:vehicle[index('vehicles-repeat')]/dmv:leased"/>
                                                </xforms:action>
                                                <xforms:trigger appearance="xxforms:image">
                                                    <xforms:label>Add Vehicle</xforms:label>
                                                    <xxforms:img src="/images/add.gif"/>
                                                </xforms:trigger>
                                                <xforms:trigger appearance="xxforms:link">
                                                    <xforms:label>Add Vehicle</xforms:label>
                                                </xforms:trigger>
                                            </xforms:group>
                                        </td>
                                        <td>
                                            <xforms:group ref="instance('control-instance')/vehicle-delete-trigger">
                                                <xforms:action ev:event="DOMActivate">
                                                    <xforms:delete nodeset="instance('main-instance')//dmv:vehicles/dmv:vehicle" at="index('vehicles-repeat')"/>
                                                </xforms:action>
                                                <xforms:trigger appearance="xxforms:image">
                                                    <xforms:label>Delete Vehicle</xforms:label>
                                                    <xxforms:img src="/images/remove.gif"/>
                                                </xforms:trigger>
                                                <xforms:trigger appearance="xxforms:link">
                                                    <xforms:label>Delete Vehicle</xforms:label>
                                                </xforms:trigger>
                                            </xforms:group>
                                        </td>
                                    </tr>
                                </table>

                                <!-- Simple version of the triggers -->
                                <!--<xforms:trigger ref="instance('control-instance')/vehicle-insert-trigger">-->
                                    <!--<xforms:label>Add</xforms:label>-->
                                    <!--<xforms:action ev:event="DOMActivate">-->
                                        <!--<xforms:insert nodeset="instance('main-instance')//dmv:vehicles/dmv:vehicle" at="index('vehicles-repeat')" position="after"/>-->
                                    <!--</xforms:action>-->
                                <!--</xforms:trigger>-->
                                <!--<xforms:trigger ref="instance('control-instance')/vehicle-delete-trigger">-->
                                    <!--<xforms:label>Remove</xforms:label>-->
                                    <!--<xforms:action ev:event="DOMActivate">-->
                                        <!--<xforms:delete nodeset="instance('main-instance')//dmv:vehicles/dmv:vehicle" at="index('vehicles-repeat')"/>-->
                                    <!--</xforms:action>-->
                                <!--</xforms:trigger>-->

                                <table class="dmv-gridtable">
                                    <tr>
                                        <th>California Plate / CF / Placard No.</th>
                                        <th>Vehicle Id or Vessel Hull Id Number</th>
                                        <th>Check If Leased</th>
                                    </tr>
                                    <xforms:repeat nodeset="dmv:vehicle" id="vehicles-repeat">
                                        <tr>
                                            <td>
                                                <xforms:input incremental="true" ref="dmv:plate-number" class="dmv-plate-number">
                                                    <xforms:label/>
                                                    <xforms:alert ref="instance('messages-instance')/alerts/plate-number"/>
                                                </xforms:input>
                                            </td>
                                            <td>
                                                <xforms:input incremental="true" ref="dmv:vin" class="dmv-vin">
                                                    <xforms:label/>
                                                    <xforms:alert ref="instance('messages-instance')/alerts/vin"/>
                                                    <!--<xforms:hint>Last 17 Positions</xforms:hint>-->
                                                </xforms:input>
                                            </td>
                                            <td align="center">
                                                <xforms:select ref="dmv:leased" appearance="full">
                                                    <xforms:label/>
                                                    <xforms:item>
                                                        <xforms:label></xforms:label>
                                                        <xforms:value>Y</xforms:value>
                                                    </xforms:item>
                                                </xforms:select>
                                            </td>
                                        </tr>
                                    </xforms:repeat>
                                    <tr/><!-- This is to work around a bug in IE -->
                                </table>

                                <!-- TODO: Fix bug in xforms:repeat to enable this
                                <xforms:repeat nodeset="instance('plate-instance')/plate[1]">
                                    <table class="dmv-plate-table">
                                        <tr>
                                            <td>
                                                <span style="position: relative; top: 15px">
                                                    <xforms:repeat nodeset="character[. != '']">
                                                        <xforms:output mediatype="image/gif" value="concat('/examples/forms/images/_', ., '_small.gif')"/>
                                                    </xforms:repeat>
                                                </span>
                                            </td>
                                        </tr>
                                    </table>
                                </xforms:repeat>
                                -->
                            </td>
                        </tr>
                    </xforms:group>
                    <tr><td colspan="2" class="dmv-hr"/></tr>
                    <xforms:group ref="dmv:leased-vehicles">
                        <tr>
                            <th>
                                Leased Vehicles
                            </th>
                            <td>
                                <xforms:input incremental="true" ref="dmv:company-name" class="dmv-company-name">
                                    <xforms:label>Leasing Company's Name</xforms:label>
                                    <xforms:alert ref="instance('messages-instance')/alerts/company-name"/>
                                </xforms:input>
                            </td>
                        </tr>
                    </xforms:group>
                    <tr><td colspan="2" class="dmv-hr"/></tr>
                    <tr>
                        <th>
                            Location of<br/>
                            Trailer Coach<br/>
                            or Vessel<br/>
                        </th>
                        <td>

                            <table class="dmv-actions-table">
                                <tr>
                                    <td>
                                        <xforms:group ref="instance('control-instance')/remove-vehicle-address">
                                            <xforms:action ev:event="DOMActivate">
                                                <xforms:delete nodeset="instance('main-instance')//dmv:vehicle-address" at="last()"/>
                                            </xforms:action>
                                            <xforms:trigger appearance="xxforms:image">
                                                <xforms:label>Remove Vehicle Address</xforms:label>
                                                <xxforms:img src="/images/remove.gif"/>
                                            </xforms:trigger>
                                            <xforms:trigger appearance="xxforms:link">
                                                <xforms:label>Remove Vehicle Address</xforms:label>
                                            </xforms:trigger>
                                        </xforms:group>

                                        <xforms:group ref="instance('control-instance')/clear-vehicle-address">
                                            <xforms:action ev:event="DOMActivate" >
                                                <xforms:dispatch name="dmv-clear-vehicle-address" target="main-model"/>
                                            </xforms:action>
                                            <xforms:trigger appearance="xxforms:image">
                                                <xforms:label>Clear Address</xforms:label>
                                                <xxforms:img src="/images/recycle-green.png"/>
                                            </xforms:trigger>
                                            <xforms:trigger appearance="xxforms:link">
                                                <xforms:label>Clear Address</xforms:label>
                                            </xforms:trigger>
                                        </xforms:group>
                                    </td>
                                    <td>
                                        <xforms:group ref="instance('control-instance')/add-vehicle-address">
                                            <xforms:action ev:event="DOMActivate">
                                                <xforms:insert nodeset="instance('main-instance')//dmv:vehicle-information/dmv:leased-vehicles" at="last()" position="after"
                                                        origin="instance('vehicle-address-template-instance')"/>
                                            </xforms:action>
                                            <xforms:trigger appearance="xxforms:image">
                                                <xforms:label>Add Vehicle Address</xforms:label>
                                                <xxforms:img src="/images/add.gif"/>
                                            </xforms:trigger>
                                            <xforms:trigger appearance="xxforms:link">
                                                <xforms:label>Add Vehicle Address</xforms:label>
                                            </xforms:trigger>
                                        </xforms:group>
                                    </td>
                                </tr>
                            </table>
                            <xforms:group ref="dmv:vehicle-address">
                                <table>
                                    <tr>
                                        <td align="right">
                                            <xforms:input incremental="true" ref="dmv:street/dmv:number" class="dmv-street-number">
                                                <xforms:label>Street Number Only</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-number"/>
                                            </xforms:input>
                                        </td>
                                        <td>
                                            <xforms:input incremental="true" ref="dmv:street/dmv:name-1" class="dmv-street-name-1">
                                                <xforms:label>Street Name 1</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-name-1"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td align="right">
                                        </td>
                                        <td>
                                            <xforms:input incremental="true" ref="dmv:street/dmv:name-2" class="dmv-street-name-2">
                                                <xforms:label>Street Name 2</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/street-name-2"/>
                                            </xforms:input>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <xforms:input incremental="true" ref="dmv:city" class="dmv-city">
                                                <xforms:label>City</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/city"/>
                                                <!--<xforms:hint>Do Not Abbreviate - Use First 22 Characters in City Name</xforms:hint>-->
                                            </xforms:input>
                                            <xforms:input incremental="true" ref="dmv:county" class="dmv-county">
                                                <xforms:label>County</xforms:label>
                                                <xforms:alert ref="instance('messages-instance')/alerts/county"/>
                                                <!--<xforms:hint>Do Not Abbreviate</xforms:hint>-->
                                            </xforms:input>
                                        </td>
                                    </tr>
                                </table>
                            </xforms:group>
                        </td>
                    </tr>
                </xforms:group>
                <tr><td colspan="2" class="dmv-hr"/></tr>
                <xforms:group ref="dmv:address-information/dmv:address[@type = 'old']">
                    <tr>
                        <th>
                            Old Address
                        </th>
                        <td>
                            <table>
                                <tr>
                                    <td align="right">
                                        <xforms:input incremental="true" ref="dmv:street/dmv:number" class="dmv-street-number">
                                            <xforms:label>Street Number Only</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/street-number"/>
                                        </xforms:input>
                                    </td>
                                    <td>
                                        <xforms:input incremental="true" ref="dmv:street/dmv:name-1" class="dmv-street-name-1">
                                            <xforms:label>Street Name 1</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/street-name-1"/>
                                        </xforms:input>
                                    </td>
                                </tr>
                                <tr>
                                    <td align="right">
                                        <xforms:input incremental="true" ref="dmv:apt" class="dmv-apt-number">
                                            <xforms:label>Apt. No</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/apt"/>
                                        </xforms:input>
                                    </td>
                                    <td>
                                        <xforms:input incremental="true" ref="dmv:street/dmv:name-2" class="dmv-street-name-2">
                                            <xforms:label>Street Name 2</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/street-name-2"/>
                                        </xforms:input>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <xforms:input incremental="true" ref="dmv:city" class="dmv-city">
                                            <xforms:label>City</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/city"/>
                                            <!--<xforms:hint>Do Not Abbreviate - Use First 22 Characters in City Name</xforms:hint>-->
                                        </xforms:input>
                                        <xforms:input incremental="true" ref="dmv:state" class="dmv-state">
                                            <xforms:label>State</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/state"/>
                                        </xforms:input>
                                        <xforms:input incremental="true" ref="dmv:zip" class="dmv-zip">
                                            <xforms:label>Zip Code</xforms:label>
                                            <xforms:alert ref="instance('messages-instance')/alerts/zip"/>
                                        </xforms:input>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </xforms:group>
            </table>

        </xforms:group><!-- ref="instance('main-instance')" -->

    </body>
</html>
