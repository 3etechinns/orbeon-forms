<!--
    Copyright (C) 2006 Orbeon, Inc.

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<xhtml:html xmlns:xforms="http://www.w3.org/2002/xforms"
            xmlns:f="http://orbeon.org/oxf/xml/formatting"
            xmlns:xhtml="http://www.w3.org/1999/xhtml"
            xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
            xmlns:widget="http://orbeon.org/oxf/xml/widget"
            xmlns:ev="http://www.w3.org/2001/xml-events"
            xmlns:xs="http://www.w3.org/2001/XMLSchema">

<xhtml:head>
    <xhtml:title>Resizing Images With XForms and Flickr</xhtml:title>
    <xforms:model>
        <xforms:instance>
            <instanceData>
                <method>flickr.photos.search</method>
                <api_key>68149024a667e0be3c63708f002ffe1e</api_key>
                <tags/>
                <per_page>12</per_page>
            </instanceData>
        </xforms:instance>
        <xforms:instance id="inst-rs">
            <dummy/>
        </xforms:instance>
        <xforms:instance id="inst-control">
            <instanceData>
                <size>75</size>
            </instanceData>
        </xforms:instance>
        <xforms:submission id="sub-flickr"
                           method="get" action="http://www.flickr.com/services/rest/" separator="&amp;"
                           replace="instance" instance="inst-rs">
            <xforms:toggle case="case-busy" ev:event="xforms-submit"/>
            <xforms:toggle case="case-done" ev:event="xforms-submit-done"/>
        </xforms:submission>
        <xforms:bind nodeset="instance('inst-control')/size" type="xs:integer"/>
    </xforms:model>
    <xhtml:style type="text/css">
        body
        {
        font-family : "Trebuchet MS", Verdana, Helvetica, Sans-Serif;
        font-size : 11px;
        }

        #main-body
        {
        margin : 0;
        background-color : #eee;
        border : 5px solid #333;
        padding : 15px;
        display : block;
        }
        <!--.disabled, .xforms-case .deselected-->
        <!--{-->
        <!--display : none;-->
        <!--}-->
        .xforms-output .image
        {
        border : 1px solid black;
        width : 75px;
        height : 75px;
        margin : 5px;
        }
        <!--.range-slider-->
        <!--{-->
        <!--width : 0.5em;-->
        <!--height : 1em;-->
        <!--}-->
<!---->
        <!--.range-visibleSlider-->
        <!--{-->
        <!--width : 0.5em;-->
        <!--height : 1em;-->
        <!--}-->
        <!--.in-range .range-lineHolder-->
        <!--{-->
        <!--background-color : transparent;-->
        <!--}-->
    </xhtml:style>
</xhtml:head>
<xhtml:body>
    <xforms:group id="main-body">
        <xforms:input ref="tags">
            <xforms:label>Tags:</xforms:label>
        </xforms:input>
        <xforms:submit submission="sub-flickr">
            <xforms:label>Find</xforms:label>
        </xforms:submit>
        <xforms:range
                ref="instance('inst-control')/size"
                incremental="true"
                start="1" end="200">
            <xforms:label>Size:</xforms:label>
        </xforms:range>
        <xforms:switch>
            <xforms:case id="case-start"></xforms:case>
            <xforms:case id="case-busy">
                <img src="/images/loading.gif" alt="Busy"/>
            </xforms:case>
            <xforms:case id="case-done">
                <xforms:group ref="instance('inst-rs')">
                    <xforms:output ref="err/@msg">
                        <xforms:label>Error:</xforms:label>
                    </xforms:output>

                    <xforms:group ref="photos/photo[1]">
                        <xforms:output
                                value="concat(
                '&lt;img',
                  ' src=&#34;http://static.flickr.com/',
                    @server, '/',
                    @id, '_',
                    @secret,
                    '_',
                    if (instance('inst-control')/scale &lt; 100)
                      then 's' else  'm',
                    '.jpg&#34;',
                  ' style=&#34;',
                    'width:', instance('inst-control')/scale, ';',
                    ' height:', instance('inst-control')/scale, ';&#34;',
                '/&gt;'
               )"
                                class="image"
                                mediatype="text/html"
                                />
                    </xforms:group>

                    <!--<xforms:repeat nodeset="photos/photo">-->
                    <!--<xforms:output-->
                    <!--value="concat(-->
                    <!--'&lt;img',-->
                    <!--' src=&#34;http://static.flickr.com/',-->
                    <!--@server, '/',-->
                    <!--@id, '_',-->
                    <!--@secret,-->
                    <!--'_',-->
                    <!--if (instance('inst-control')/scale &lt; 100)-->
                    <!--then 's' else  'm',-->
                    <!--'.jpg&#34;',-->
                    <!--' style=&#34;',-->
                    <!--'width:', instance('inst-control')/scale, ';',-->
                    <!--' height:', instance('inst-control')/scale, ';&#34;',-->
                    <!--'/&gt;'-->
                    <!--)"-->
                    <!--class="image"-->
                    <!--mediatype="text/html"-->
                    <!--/>-->
                    <!--</xforms:repeat>-->
                </xforms:group>
            </xforms:case>
        </xforms:switch>
        <xforms:output ref="instance('inst-rs')/err/@msg">
            <xforms:label>Error:</xforms:label>
        </xforms:output>
    </xforms:group>
</xhtml:body>
</xhtml:html>
