<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2007 Orbeon, Inc.
  
    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.
  
    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.
  
    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<config xmlns="http://www.orbeon.com/oxf/controller"
        xmlns:oxf="http://www.orbeon.com/oxf/processors">

    <!-- Home redirects to Form Builder summary page -->
    <page path-info="/fr/?" matcher="oxf:perl5-matcher">
        <action>
            <result page="summary" transform="oxf:xinclude">
                <request xmlns="">
                    <app>orbeon</app>
                    <form>builder</form>
                </request>
            </result>
        </action>
    </page>

    <!-- ==== Pages ==== -->

    <page id="summary"
          path-info="/fr/([^/]+)/([^/]+)(/summary/|/list/)?" matcher="oxf:perl5-matcher"
          default-submission="summary/submission-page-summary.xml"
          model="summary/view.xhtml" view="html-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
    </page>

    <!-- New document -->
    <page path-info="/fr/([^/]+)/([^/]+)/(new)/" matcher="oxf:perl5-matcher"
          default-submission="submission-page-detail.xml"
          model="detail/read-form.xpl" view="html-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
        <setvalue ref="/*/mode" matcher-group="3"/>
    </page>

    <!-- Print document to HTML -->
    <page path-info="/fr/([^/]+)/([^/]+)/(print)" matcher="oxf:perl5-matcher"
          view="print-html.xpl"/>

    <!-- Print document to PDF (automatic mode) -->
    <page path-info="/fr/([^/]+)/([^/]+)/(pdf)" matcher="oxf:perl5-matcher"
          view="print-pdf.xpl"/>

    <!-- Print document to PDF (template mode) -->
    <page path-info="/fr/([^/]+)/([^/]+)/(pdf-template)" matcher="oxf:perl5-matcher"
          view="print-pdf-template.xpl"/>

    <!-- Edit document -->
    <page path-info="/fr/([^/]+)/([^/]+)/([^/]+)/(edit)" matcher="oxf:perl5-matcher"
          default-submission="submission-page-detail.xml"
          model="detail/read-form.xpl" view="html-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
        <setvalue ref="/*/document" matcher-group="3"/>
        <setvalue ref="/*/mode" matcher-group="4"/>
    </page>

    <!-- View document as HTML -->
    <page path-info="/fr/([^/]+)/([^/]+)/([^/]+)/(view)" matcher="oxf:perl5-matcher"
          default-submission="submission-page-detail.xml"
          model="detail/read-form.xpl" view="html-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
        <setvalue ref="/*/document" matcher-group="3"/>
        <setvalue ref="/*/mode" matcher-group="4"/>
    </page>

    <!-- View document as PDF -->
    <page path-info="/fr/([^/]+)/([^/]+)/([^/]+)/(pdf)" matcher="oxf:perl5-matcher"
          default-submission="submission-page-detail.xml"
          model="detail/read-form.xpl" view="pdf-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
        <setvalue ref="/*/document" matcher-group="3"/>
        <setvalue ref="/*/mode" matcher-group="4"/>
    </page>

    <!-- Test form by retrieving form from the database first -->
    <page path-info="/fr/([^/]+)/([^/]+)/([^/]+)/(test)" matcher="oxf:perl5-matcher"
          default-submission="submission-page-detail.xml"
          model="test-model.xpl" view="html-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
        <setvalue ref="/*/document" matcher-group="3"/>
        <setvalue ref="/*/mode" matcher-group="4"/>
    </page>

    <!-- Test form "inline" (when being edited) with new empty document -->
    <page id="test-form" path-info="/fr/([^/]+)/([^/]+)/(test)" matcher="oxf:perl5-matcher"
          model="inline-test-model.xpl" view="html-view.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
        <setvalue ref="/*/mode" matcher-group="3"/>
    </page>

    <!-- Upload document and start from there -->
    <page path-info="/fr/upload" model="import-export/upload.xpl"/>

    <!-- Serve document previously produced -->
    <page path-info="/fr/serve" model="import-export/serve.xpl" default-submission="import-export/serve-instance.xml">
        <setvalue ref="/instance/uuid" parameter="uuid"/>
        <setvalue ref="/instance/filename" parameter="filename"/>
    </page>

    <!-- Custom pages provided by the project -->
    <page path-info="/fr/page/custom/([^/]+)/([^/]+)" matcher="oxf:perl5-matcher"
          view="/forms/${1}/page/${2}.xhtml"/>

    <!-- ==== Built-in eXist-based Persistence Services ==== -->

    <!-- Create, Read, Update and Delete operations (id provided) -->
    <page path-info="/fr/service/exist/crud/([^/]+/[^/]+/(form/[^/]+|data/[^/]+/[^/]+))" matcher="oxf:perl5-matcher"
          model="persistence/exist/crud.xpl"/>

    <!-- Search -->
    <page path-info="/fr/service/exist/search/([^/]+)/([^/]+)" matcher="oxf:perl5-matcher"
          view="persistence/exist/search.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
    </page>

    <!-- List deployed forms for a given application -->
    <page path-info="/fr/service/exist/list/([^/]+)" matcher="oxf:perl5-matcher"
          default-submission="persistence/exist/list-submission.xml"
          view="persistence/exist/list.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
    </page>

    <!-- ==== Built-in Oracle-based Persistence Services ==== -->

    <!-- Create, Read, Update and Delete operations (id provided) -->
    <page path-info="/fr/service/oracle/crud/([^/]+/[^/]+/(form/[^/]+|data/[^/]+/[^/]+))" matcher="oxf:perl5-matcher"
          model="persistence/oracle/crud.xpl"/>

    <!-- Search -->
    <page path-info="/fr/service/oracle/search/([^/]+)/([^/]+)" matcher="oxf:perl5-matcher"
          view="persistence/oracle/search.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
        <setvalue ref="/*/form" matcher-group="2"/>
    </page>

    <!-- List deployed forms for a given application -->
    <page path-info="/fr/service/oracle/list/([^/]+)" matcher="oxf:perl5-matcher"
          default-submission="persistence/oracle/list-submission.xml"
          view="persistence/oracle/list.xpl">
        <setvalue ref="/*/app" matcher-group="1"/>
    </page>

    <!-- ==== Built-in Resource Manager-Based Persistence Services ==== -->

    <!-- Create, Read, Update and Delete operations (id provided) -->
    <page path-info="/fr/service/resource/crud/([^/]+/[^/]+/(form/[^/]+|data/[^/]+/[^/]+))" matcher="oxf:perl5-matcher"
          default-submission="submission-service-resource.xml"
          model="persistence/resource/crud.xpl">
        <setvalue ref="/*/resource" matcher-group="1"/>
    </page>

    <!-- ==== Other Services ==== -->

    <!-- Generate HTML to be saved -->
    <page path-info="/fr/service/import-export/save-generate" view="import-export/save-generate.xpl"/>

    <!-- Custom services provided by the project -->
    <page path-info="/fr/service/custom/([^/]+)/([^/]+)" matcher="oxf:perl5-matcher"
          view="/forms/${1}/service/${2}.xpl"/>

    <epilogue url="oxf:/config/epilogue.xpl"/>

</config>
