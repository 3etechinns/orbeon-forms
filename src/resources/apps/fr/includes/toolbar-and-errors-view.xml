<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2008 Orbeon, Inc.

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<xhtml:table class="fr-error-buttons"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:xs="http://www.w3.org/2001/XMLSchema"
        xmlns:xhtml="http://www.w3.org/1999/xhtml"
        xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
        xmlns:xforms="http://www.w3.org/2002/xforms"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        xmlns:xxi="http://orbeon.org/oxf/xml/xinclude"
        xmlns:saxon="http://saxon.sf.net/">

    <xforms:group model="fr-persistence-model" appearance="xxforms:internal">
        <xhtml:tr>
            <xhtml:td colspan="2">
                <!-- Display clean/dirty status -->
                <xforms:group ref="instance('fr-persistence-instance')[data-status = 'dirty']">
                    <!-- TODO: i18n or use icon instead -->
                    <xhtml:p class="fr-unsaved-data">Your document contains unsaved changes.</xhtml:p>
                </xforms:group>
                <xforms:group ref="instance('fr-persistence-instance')[data-status = 'clean']"/>
                <!-- Display messages -->
                <xforms:switch>
                    <xforms:case id="orbeon-message-none">
                        <xhtml:p/>
                    </xforms:case>
                    <xforms:case id="fr-message-success">
                        <xhtml:p class="fr-message-success">
                            <xforms:output value="instance('fr-persistence-instance')/message"/>
                        </xhtml:p>
                    </xforms:case>
                    <xforms:case id="fr-message-validation-error">
                        <xhtml:p class="fr-message-validation-error">
                            <xforms:output value="instance('fr-persistence-instance')/message"/>
                        </xhtml:p>
                    </xforms:case>
                    <xforms:case id="fr-message-fatal-error">
                        <xhtml:p class="fr-message-fatal-error">
                            <xforms:output value="instance('fr-persistence-instance')/message"/>
                        </xhtml:p>
                    </xforms:case>
                </xforms:switch>
            </xhtml:td>
        </xhtml:tr>
        <xhtml:tr>
            <xhtml:td>
                <xforms:group ref=".[instance('fr-persistence-instance')/save-attempted = 'true']">
                    <xforms:group model="fr-error-summary-model" ref="instance('errors-instance')[error]">
                        <!-- TODO: i18n -->
                        <xhtml:span class="fr-error-title">Your document has the following issues:</xhtml:span>
                        <xhtml:ol class="fr-error-list">
                            <xforms:repeat nodeset="error" id="fr-errors-repeat">
                                <xhtml:li>
                                    <xforms:output value="@label" class="fr-error-label"/>
                                    <xforms:group ref=".[string-length(@indexes) > 0]" class="fr-error-row">
                                        <xforms:output value="concat('(row ', @indexes, ')')"/>
                                    </xforms:group>
                                    <xforms:group ref=".[normalize-space(@alert) != '']" class="fr-error-alert">
                                        - <xforms:output value="@alert"/>
                                    </xforms:group>
                                </xhtml:li>
                            </xforms:repeat>
                        </xhtml:ol>
                    </xforms:group>
                    <xforms:group model="fr-error-summary-model" ref="instance('errors-instance')[not(error)]">
                        <!--<table class="orbeon-no-errors-table">-->
                            <!--<tr>-->
                                <!--<th colspan="3" class="no-error-title">Form valid</th>-->
                            <!--</tr>-->
                        <!--</table>-->
                    </xforms:group>
                </xforms:group>
            </xhtml:td>
            <xhtml:td>
                <xhtml:div class="fr-buttons">
                    <!-- Trigger shown to go back if the data is dirty -->
                    <xforms:trigger ref="instance('fr-persistence-instance')[data-status = 'dirty']">
                        <xforms:label><xhtml:img src="/apps/fr/style/previous.gif" alt=""/> <xhtml:span>Discard</xhtml:span></xforms:label>
                        <!-- TODO -->
                        <!--<xforms:action ev:event="DOMActivate">-->
                            <!--<xforms:dispatch target="fr-persistence-model" name="orbeon-save"/>-->
                        <!--</xforms:action>-->
                    </xforms:trigger>
                    <!-- Trigger shown to go back if the data is clean -->
                    <xforms:trigger ref="instance('fr-persistence-instance')[data-status = 'clean']">
                        <xforms:label><xhtml:img src="/apps/fr/style/previous.gif" alt=""/> <xhtml:span>Back</xhtml:span></xforms:label>
                        <!-- TODO -->
                        <!--<xforms:action ev:event="DOMActivate">-->
                            <!--<xforms:dispatch target="fr-persistence-model" name="orbeon-save"/>-->
                        <!--</xforms:action>-->
                    </xforms:trigger>
                    <xforms:trigger ref="instance('fr-triggers-instance')/save">
                        <xforms:label><xhtml:img src="/apps/fr/style/run.gif" alt=""/> <xhtml:span>Save Form</xhtml:span></xforms:label>
                        <xforms:action ev:event="DOMActivate">
                            <xforms:dispatch target="fr-persistence-model" name="orbeon-save"/>
                        </xforms:action>
                    </xforms:trigger>
                </xhtml:div>
            </xhtml:td>
        </xhtml:tr>
    </xforms:group>
</xhtml:table>
